FROM php:8.2-apache

# Copy the whole backend into the container
COPY . /var/www/backend

# Serve the public directory
RUN sed -i 's#DocumentRoot /var/www/html#DocumentRoot /var/www/backend/public#g' /etc/apache2/sites-available/000-default.conf

# Enable rewrite and headers modules (useful for SPA and CORS)
RUN a2enmod rewrite headers

# Install MySQL extensions required by the app (mysqli, pdo_mysql)
RUN docker-php-ext-install mysqli pdo_mysql || true
RUN docker-php-ext-enable mysqli pdo_mysql || true

# Ensure file permissions are reasonable
RUN chown -R www-data:www-data /var/www/backend

EXPOSE 80

CMD ["apache2-foreground"]

# Build and run:
# docker build -t medapp-apache -f backend/Dockerfile-httpd-php .
# docker run -p 8080:80 --name medapp -v $(pwd)/backend:/var/www/backend medapp-apache